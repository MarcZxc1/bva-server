generator client {
  provider      = "prisma-client-js"
  output        = "../src/generated/prisma"
  binaryTargets = ["native", "linux-musl-openssl-3.0.x"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Campaign {
  id          String         @id @default(uuid())
  shopId      String
  name        String
  content     Json
  status      CampaignStatus @default(DRAFT)
  scheduledAt DateTime?
  createdAt   DateTime       @default(now())
  imageUrl    String?
  updatedAt   DateTime       @updatedAt
  Shop        Shop           @relation(fields: [shopId], references: [id])
}

model Forecast {
  id        String   @id @default(uuid())
  productId String
  date      DateTime
  predicted Int
  method    String
  createdAt DateTime @default(now())
  Product   Product  @relation(fields: [productId], references: [id])

  @@unique([productId, date, method])
}

model Integration {
  id        String   @id @default(uuid())
  shopId    String
  platform  Platform
  settings  Json
  createdAt DateTime @default(now())
  Shop      Shop     @relation(fields: [shopId], references: [id])

  @@unique([shopId, platform])
}

model Inventory {
  id           String         @id @default(uuid())
  productId    String
  quantity     Int            @default(0)
  location     String?
  updatedAt    DateTime       @updatedAt
  batchNumber  String?
  threshold    Int            @default(10)
  Product      Product        @relation(fields: [productId], references: [id])
  InventoryLog InventoryLog[]
}

model InventoryLog {
  id          String    @id @default(uuid())
  inventoryId String
  delta       Int
  reason      String?
  timestamp   DateTime  @default(now())
  Inventory   Inventory @relation(fields: [inventoryId], references: [id])
}

model Notification {
  id        String   @id @default(uuid())
  userId    String
  title     String
  message   String
  type      String
  isRead    Boolean  @default(false)
  createdAt DateTime @default(now())
  User      User     @relation(fields: [userId], references: [id])
}

model Product {
  id          String      @id @default(uuid())
  shopId      String
  sku         String
  name        String
  description String?
  price       Float
  cost        Float?
  expiryDate  DateTime?
  createdAt   DateTime    @default(now())
  updatedAt   DateTime    @updatedAt
  category    String?
  externalId  String?
  imageUrl    String?
  stock       Int         @default(0)
  Forecast    Forecast[]
  Inventory   Inventory[]
  Shop        Shop        @relation(fields: [shopId], references: [id])

  @@unique([shopId, externalId])
  @@unique([shopId, sku])
}

model Sale {
  id              String   @id @default(uuid())
  shopId          String
  platform        Platform
  platformOrderId String?
  items           Json
  total           Float
  createdAt       DateTime @default(now())
  customerEmail   String?
  customerName    String?
  externalId      String?
  profit          Float?
  revenue         Float?
  status          OrderStatus @default(PENDING)
  Shop            Shop     @relation(fields: [shopId], references: [id])

  @@unique([platform, platformOrderId])
  @@unique([shopId, externalId])
}

model Shop {
  id          String        @id @default(uuid())
  name        String
  ownerId     String
  platform    Platform      @default(SHOPEE)
  createdAt   DateTime      @default(now())
  Campaign    Campaign[]
  Integration Integration[]
  Product     Product[]
  Sale        Sale[]
  User        User          @relation(fields: [ownerId], references: [id])
  ShopAccess  ShopAccess[]

  @@unique([ownerId, platform])
}

model ShopAccess {
  id        String   @id @default(uuid())
  userId    String
  shopId    String
  createdAt DateTime @default(now())
  User      User     @relation(fields: [userId], references: [id])
  Shop      Shop     @relation(fields: [shopId], references: [id])

  @@unique([userId, shopId])
}

model SocialMediaAccount {
  id           String    @id @default(uuid())
  userId       String
  platform     String
  accessToken  String
  refreshToken String?
  pageId       String?
  accountId    String?
  expiresAt    DateTime?
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt
  User         User      @relation(fields: [userId], references: [id])

  @@unique([userId, platform])
}

model User {
  id                 String               @id @default(uuid())
  email              String
  password           String?
  name               String?
  role               Role                 @default(SELLER)
  createdAt          DateTime             @default(now())
  updatedAt          DateTime             @updatedAt
  firstName          String?
  lastName           String?
  googleId           String?
  shopeeId           String?              @unique
  facebookId         String?
  platform           UserPlatform         @default(BVA)
  Notification       Notification[]
  Shop               Shop[]
  SocialMediaAccount SocialMediaAccount[]
  ShopAccess         ShopAccess[]

  @@unique([email, platform])
}

enum CampaignStatus {
  DRAFT
  SCHEDULED
  PUBLISHED
  ARCHIVED
}

enum Platform {
  SHOPEE
  LAZADA
  TIKTOK
  OTHER
}

enum Role {
  ADMIN
  SELLER
  ANALYST
  BUYER
}

enum UserPlatform {
  SHOPEE_CLONE
  LAZADA_CLONE
  TIKTOK_CLONE
  BVA
}

enum OrderStatus {
  PENDING
  TO_SHIP
  TO_RECEIVE
  COMPLETED
  CANCELLED
  RETURNED
  REFUNDED
  FAILED
}
